(()=>{"use strict";const t=Symbol("Comlink.proxy"),e=Symbol("Comlink.endpoint"),n=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.thrown"),r=t=>"object"==typeof t&&null!==t||"function"==typeof t,i=new Map([["proxy",{canHandle:e=>r(e)&&e[t],serialize(t){const{port1:e,port2:n}=new MessageChannel;return s(t,e),[n,[n]]},deserialize(t){return t.start(),function t(a,r=[],i=function(){}){let s=!1;const u=new Proxy(i,{get(e,i){if(c(s),i===n)return()=>p(a,{type:"RELEASE",path:r.map(t=>t.toString())}).then(()=>{o(a),s=!0});if("then"===i){if(0===r.length)return{then:()=>u};const t=p(a,{type:"GET",path:r.map(t=>t.toString())}).then(h);return t.then.bind(t)}return t(a,[...r,i])},set(t,e,n){c(s);const[i,o]=f(n);return p(a,{type:"SET",path:[...r,e].map(t=>t.toString()),value:i},o).then(h)},apply(n,i,o){c(s);const u=r[r.length-1];if(u===e)return p(a,{type:"ENDPOINT"}).then(h);if("bind"===u)return t(a,r.slice(0,-1));const[f,g]=l(o);return p(a,{type:"APPLY",path:r.map(t=>t.toString()),argumentList:f},g).then(h)},construct(t,e){c(s);const[n,i]=l(e);return p(a,{type:"CONSTRUCT",path:r.map(t=>t.toString()),argumentList:n},i).then(h)}});return u}(t,[],a);var a}}],["throw",{canHandle:t=>r(t)&&a in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function s(e,n=self){n.addEventListener("message",(function r(i){if(!i||!i.data)return;const{id:c,type:l,path:p}=Object.assign({path:[]},i.data),g=(i.data.argumentList||[]).map(h);let y;try{const n=p.slice(0,-1).reduce((t,e)=>t[e],e),a=p.reduce((t,e)=>t[e],e);switch(l){case"GET":y=a;break;case"SET":n[p.slice(-1)[0]]=h(i.data.value),y=!0;break;case"APPLY":y=a.apply(n,g);break;case"CONSTRUCT":y=function(e){return Object.assign(e,{[t]:!0})}(new a(...g));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;s(e,n),y=function(t,e){return u.set(t,e),t}(t,[t])}break;case"RELEASE":y=void 0;break;default:return}}catch(t){y={value:t,[a]:0}}Promise.resolve(y).catch(t=>({value:t,[a]:0})).then(t=>{const[e,a]=f(t);n.postMessage(Object.assign(Object.assign({},e),{id:c}),a),"RELEASE"===l&&(n.removeEventListener("message",r),o(n))})})),n.start&&n.start()}function o(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function c(t){if(t)throw new Error("Proxy has been released and is not useable")}function l(t){const e=t.map(f);return[e.map(t=>t[0]),(n=e.map(t=>t[1]),Array.prototype.concat.apply([],n))];var n}const u=new WeakMap;function f(t){for(const[e,n]of i)if(n.canHandle(t)){const[a,r]=n.serialize(t);return[{type:"HANDLER",name:e,value:a},r]}return[{type:"RAW",value:t},u.get(t)||[]]}function h(t){switch(t.type){case"HANDLER":return i.get(t.name).deserialize(t.value);case"RAW":return t.value}}function p(t,e,n){return new Promise(a=>{const r=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===r&&(t.removeEventListener("message",e),a(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:r},e),n)})}var g=function(t,e,n,a,r,i,s,o){if(t===n&&e===a||r===s&&i===o)return!1;var c=(o-i)*(n-t)-(s-r)*(a-e);if(0===c)return!1;var l=((s-r)*(e-i)-(o-i)*(t-r))/c,u=((n-t)*(e-i)-(a-e)*(t-r))/c;return!(l<0||l>1||u<0||u>1)&&{x:t+l*(n-t),y:e+l*(a-e)}},y=function(t,e,n,a){return Math.hypot(t-n,e-a)};s({intersect:g,TCASScan:function(t){var e={callsign:t.originCallsign,fans:{flightPath:t.originPath},position:t.originPos},n={callsign:t.otherCallsign,fans:{flightPath:t.otherPath},position:t.otherPos},a=!1,r=null,i=!1;if(n.callsign!==e.callsign&&n.fans.flightPath&&e.fans.flightPath){i=g(e.fans.flightPath.x1,e.fans.flightPath.y1,e.fans.flightPath.x2,e.fans.flightPath.y2,n.fans.flightPath.x1,n.fans.flightPath.y1,n.fans.flightPath.x2,n.fans.flightPath.y2);var s=y(e.position.x,e.position.y,n.position.x,n.position.y);if(s<200?a=!0:s>=200&&(a=!1),i){var o=y(e.position.x,e.position.y,i.x,i.y),c=y(n.position.x,n.position.y,i.x,i.y);o<200&&c<200&&(r=e.position.x>n.position.x?"left":"right")}}return{conflict:i,direction:r,closeProximityCraft:a}}})})();